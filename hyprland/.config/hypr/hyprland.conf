source=~/.config/hypr/latte.conf

# 2x scaling implies HiDPI.
monitor=,preferred,auto,2

#################
### AUTOSTART ###
#################

# Cursor theme
exec-once = hyprctl setcursor Bibata-Modern-Ice 24
# Input Method
exec-once = fcitx5 -d --replace

# UI Components
exec-once = waybar
exec-once = mako
exec-once = hyprpaper

# System Services
exec-once = udiskie
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store

###################
### ENVIRONMENT ###
###################

# Hardware Acceleration
env = AQ_DRM_DEVICES,/dev/dri/card1
env = LIBVA_DRIVER_NAME,nvidia
env = GBM_BACKEND,nvidia-drm
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
env = NVD_BACKEND,direct
env = ELECTRON_OZONE_PLATFORM_HINT,auto
env = XDG_SESSION_TYPE,wayland
# Cursor & Appearance
env = XCURSOR_SIZE,24
env = HYPRCURSOR_SIZE, 24

# Input Method Environment
env = XMODIFIERS, @im=fcitx
# env = QT_IM_MODULE, fcitx # QT6 apps might prefer not having this set
# env = GLFW_IM_MODULE, ibus
env = QT_QPA_PLATFORM,wayland

#####################
### LOOK AND FEEL ###
#####################

general {
    gaps_in = 2
    gaps_out = 0
    border_size = 2
    
    # 极简冰川白 - 配合你的 Waybar
    col.active_border = rgba(ffffffcc) rgba(ffffff88) 45deg
    col.inactive_border = rgba(59595933)

    resize_on_border = false
    allow_tearing = false
    layout = master
}

decoration {
    rounding = 12
    rounding_power = 2

    active_opacity = 0.95
    inactive_opacity = 0.85
    dim_inactive = true
    dim_strength = 0.03

    shadow {
        enabled = false
        range = 20
        render_power = 3
        color = rgba(00000020)
        offset = 2 2
    }

    blur {
        enabled = true
        size = 5
        passes = 2
        new_optimizations = true
        xray = true # 开启 xray 会让模糊更透亮，如果不喜欢可以关掉
        contrast = 1.0
        brightness = 0.9
        vibrancy = 0.1696
    }
}

animations {
    enabled = true

    # ---------------------------------------------------------
    # 1. 贝塞尔曲线定义 (Bezier Curves)
    # ---------------------------------------------------------
    
    # [极致丝滑] - 用于工作区切换和窗口移动
    # 起步快，中间匀速，结尾极其平滑的减速。在60Hz上能模拟高刷的流畅感。
    bezier = silky, 0.05, 0.9, 0.1, 1.05

    # [灵动回弹] - 用于窗口打开
    bezier = overshot, 0.05, 0.9, 0.1, 1.05

    # [干脆利落] - 用于窗口关闭和淡入淡出
    # 几乎直线的加速，迅速让出屏幕空间，不拖泥带水。
    bezier = quick, 0.85, 0, 0.15, 1

    # ---------------------------------------------------------
    # 2. 动画规则 (Animation Rules)
    # ---------------------------------------------------------
    
    # 窗口打开：使用回弹曲线，时长 3.5秒(单位100ms)，Popin效果让窗口像气泡一样浮现
    animation = windowsIn, 1, 3.5, overshot, popin 85%

    # 窗口关闭：操作要快，使用快速曲线，时长 2.5秒，迅速消失
    animation = windowsOut, 1, 2.5, quick, popin 85%

    # 窗口移动/调整大小：这是“丝滑”的核心，使用 silky 曲线，跟随手感极佳
    animation = windowsMove, 1, 4, silky

    # 边框颜色变化：略微慢一点，显得优雅
    animation = border, 1, 5, default

    # 淡入淡出：快速完成，避免视觉干扰
    animation = fade, 1, 3, quick

    # 工作区切换：操作快的用户需要流畅但迅速的切换
    # 4.5 的速度在 60Hz 上既能看清滑动轨迹，又不会觉得慢
    animation = workspaces, 1, 4.5, silky, slide
    
    # 特殊工作区（scratchpad）：从屏幕上方滑入
    animation = specialWorkspace, 1, 4, silky, slidevert
}

dwindle {
    pseudotile = true
    preserve_split = true
    force_split = 2
}

master {
    mfact = 0.55
    new_status = slave
    new_on_top = true
    special_scale_factor = 0.8
}

misc {
    force_default_wallpaper = 0
    disable_hyprland_logo = true
    disable_splash_rendering = true
    vfr = false
    vrr = 0
    focus_on_activate = false
}
# opengl {
#     nvidia_anti_flicker = true
# }
cursor {
    no_hardware_cursors = true
}
render {
    direct_scanout = false
    expand_undersized_textures = true
    new_render_scheduling = false
}


#############
### INPUT ###
#############

input {
    kb_layout = us
    kb_options = caps:ctrl_modifier
    follow_mouse = 1
    sensitivity = 0

    touchpad {
        natural_scroll = false
    }
}

device {
    name = epic-mouse-v1
    sensitivity = -0.5
}
###################
### KEYBINDINGS ###
###################

$mainMod = ALT
$terminal = kitty
$fileManager = nautilus
$menu = wofi

bind = $mainMod, RETURN, exec, $terminal
bind = $mainMod, E, exec, $fileManager
bind = $mainMod, F, fullscreen, 1
bind = $mainMod, SPACE, exec, pkill $menu || $menu
bind = $mainMod, B, exec, firefox
# dwindlw
# bind = $mainMod, P, pseudo,
# bind = $mainMod, B, togglesplit,
# master
binde = $mainMod, MINUS, layoutmsg, mfact -0.05
binde = $mainMod, EQUAL, layoutmsg, mfact +0.05
bind = $mainMod, R, layoutmsg, orientationcycle left top center
bind = $mainMod, COMMA, layoutmsg, removemaster
bind = $mainMod, PERIOD, layoutmsg, addmaster

bind = $mainMod SHIFT, N, exec, kitty --class quicknote -e nvim ~/Desktop/quick_note.txt
bind = $mainMod, V, exec, cliphist list | wofi --dmenu | cliphist decode | wl-copy
bind = $mainMod, Q, killactive,
# Screenshot
bind = $mainMod SHIFT, A, exec, grim -g "$(slurp)" - | wl-copy
# Session
bind = $mainMod CTRL, DELETE, exec, hyprctl dispatch exit
bind = $mainMod CTRL, Q , exec, hyprlock
bind = $mainMod SHIFT, SPACE, togglefloating,
bind = $mainMod SHIFT, F, fullscreen, 0

# Vim-like Focus
bind = $mainMod, H, movefocus, l
bind = $mainMod, L, movefocus, r
bind = $mainMod, K, movefocus, u
bind = $mainMod, J, movefocus, d

# Vim-like Move
bind = $mainMod SHIFT, H, movewindow, l
bind = $mainMod SHIFT, L, movewindow, r
bind = $mainMod SHIFT, K, movewindow, u
bind = $mainMod SHIFT, J, movewindow, d

# Workspaces
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# Move to Workspace
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# Special Workspace
bind = $mainMod, S, togglespecialworkspace, magic
bind = $mainMod SHIFT, S, movetoworkspace, special:magic

# Scroll Workspace
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1
bind = $mainMod, TAB, workspace, previous
bind = $mainMod SHIFT, RETURN, layoutmsg, swapwithmaster


# Mouse Move/Resize
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Media Keys
bindel = ,XF86AudioRaiseVolume, exec, wpctl set-volume -l 1 @DEFAULT_AUDIO_SINK@ 5%+
bindel = ,XF86AudioLowerVolume, exec, wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindel = ,XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindel = ,XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bindel = ,XF86MonBrightnessUp, exec, brightnessctl -e4 -n2 set 5%+
bindel = ,XF86MonBrightnessDown, exec, brightnessctl -e4 -n2 set 5%-
bindl = , XF86AudioNext, exec, playerctl next
bindl = , XF86AudioPause, exec, playerctl play-pause
bindl = , XF86AudioPlay, exec, playerctl play-pause
bindl = , XF86AudioPrev, exec, playerctl previous


####################
### WINDOW RULES ###
####################


windowrule {
    name = quicknote
    match:class =  ^(quicknote)$
    size = 800 500
    float = on
    opacity = 0.9
}

windowrule = match:class org.gnome.Nautilus, opacity 0.85

windowrule {
    # Ignore maximize requests from all apps. You'll probably like this.
    name = suppress-maximize-events
    match:class = .*

    suppress_event = maximize
}

windowrule {
    # Fix some dragging issues with XWayland
    name = fix-xwayland-drags
    match:class = ^$
    match:title = ^$
    match:xwayland = true
    match:float = true
    match:fullscreen = false
    match:pin = false

    no_focus = true
}

windowrule {
    name = Picture-in-picture
    match:title = ^Picture-in-picture$
    float = on
    pin = on
    border_size = 1
}

windowrule {
    name = Wemeet
    match:class = class:^(wemeetapp)$
    no_dim = on
    no_anim = on
    no_blur = on
    no_shadow = on
    dim_around = off
    decorate = off
    no_screen_share = off
    border_size = 0
    opacity = 1.0
}

###################
### LAYER RULES ###
###################

#
layerrule {
  name = waybar_rule
  match:namespace = waybar
  blur = on
  ignore_alpha = 0.5
}

layerrule {
  name = wofi
  match:namespace = wofi
  ignore_alpha = 0.5
  blur = on
  animation = fade
}

layerrule {
  name = no_anim_for_selection
  no_anim = on
  match:namespace = selection
}


